import{Q as E,f as k,E as O,au as T,g as j,v as H,a3 as M,H as U,a6 as $,c2 as C,K as I,c as N,o as D,S as V,_ as G}from"./DTbFyfnF.js";var m={},_={},z;function W(){return z||(z=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.fit=(e,n,a="fill")=>{if(a==="scale-down"&&(n.width<=e.width&&n.height<=e.height?a="none":a="contain"),a==="cover"||a==="contain"){const o=e.width/n.width,r=e.height/n.height,c=a==="cover"?Math.max(o,r):Math.min(o,r),d=n.width*c,h=n.height*c;return{width:d,height:h}}return a==="none"?n:e},t.position=(e,n,a="50%",o="50%")=>{const r=i(a,e.width,n.width),c=i(o,e.height,n.height);return{x:r,y:c}},t.fitAndPosition=(e,n,a="fill",o="50%",r="50%")=>{const c=t.fit(e,n,a),{x:d,y:h}=t.position(e,c,o,r),{width:g,height:w}=c;return{x:d,y:h,width:g,height:w}};const i=(e,n,a)=>e.endsWith("%")?(n-a)*(parseFloat(e)/100):parseFloat(e)}(_)),_}var F={},B;function J(){if(B)return F;B=1,Object.defineProperty(F,"__esModule",{value:!0});const t=W();return F.transformFittedPoint=(i,e,n,a="fill",o="50%",r="50%")=>{const{x:c,y:d,width:h,height:g}=t.fitAndPosition(e,n,a,o,r),w=n.width/h,v=n.height/g,p=(i.x-c)*w,P=(i.y-d)*v;return{x:p,y:P}},F}var R={},b;function K(){if(b)return R;b=1,Object.defineProperty(R,"__esModule",{value:!0});const t={contain:!0,cover:!0,fill:!0,none:!0,"scale-down":!0};return R.isFit=i=>i in t,R}var S;function Q(){if(S)return m;S=1,Object.defineProperty(m,"__esModule",{value:!0});var t=W();m.fit=t.fit,m.position=t.position,m.fitAndPosition=t.fitAndPosition;var i=J();m.transformFittedPoint=i.transformFittedPoint;var e=K();return m.isFit=e.isFit,m}var X=Q();function Y(t){return new Worker(""+new URL("video-sequence.worker-B5BJOqje.js",import.meta.url).href,{name:t==null?void 0:t.name})}const Z=({frames:t,onLoad:i,fitPosition:e={top:50,left:50},fitMode:n="cover",lazyLoad:a=!1})=>{const o={value:0},r=new Y;let c=!1,d=!1,h=null;const g=new Map,w=new Map;let v=[];const p=document.createElement("canvas"),P=p.getContext("2d");r.addEventListener("message",l=>{l.data.payload.blobs.forEach(({blob:u,frame:s})=>{if(!g.has(s)){g.set(s,u);const f=new Image;f.src=URL.createObjectURL(u),w.set(s,f)}}),v=[...w].sort((u,s)=>{const f=t.indexOf(u[0]),x=t.indexOf(s[0]);return f-x}).map(u=>u[1]),d=!0,i==null||i(v.length/t.length)});const q=(l=!1)=>{if(!d)return;o.value=Math.min(1,Math.max(0,o.value));const u=Math.floor(o.value*(v.length-1)),s=v[u];if(h===u&&!l||!s||!s.complete)return;h=u;const f={width:p.offsetWidth,height:p.offsetHeight},x={width:s.naturalWidth,height:s.naturalHeight},y=X.fitAndPosition(f,x,n,`${e.left}%`,`${e.top}%`);P.clearRect(0,0,y.width,y.height),P.drawImage(s,y.x,y.y,y.width,y.height)},A=l=>{e=l},L=()=>{if(c)return;c=!0;const l=t.slice(1),u=8,s=50,f=()=>{if(l.length<=0)return;const x=E.Arr.spliceNth(l,u);r.postMessage({type:"frames",payload:{frames:x}}),setTimeout(f,s)};f()};return r.postMessage({type:"frames",payload:{frames:[t[0]]}}),a||L(),{onUpdate:q,progress:o,canvas:p,ctx:P,requestLoad:L,setFitPosition:A,destroy:()=>{r.terminate(),v.forEach(l=>l.src="")}}},ee=k({__name:"VideoSequence",props:{frames:{},progress:{},onLoad:{type:Function},className:{},lazyLoad:{type:Boolean},fitPosition:{},fitMode:{}},setup(t){const i=O("el"),e=T(),n=j(!1);return H(()=>{var a;e.value=Z({frames:t.frames,onLoad:t.onLoad,fitPosition:t.fitPosition,lazyLoad:t.lazyLoad,fitMode:t.fitMode}),(a=i.value)==null||a.appendChild(e.value.canvas),M(()=>t.progress,o=>{e.value.progress.value=o},{immediate:!0}),M(n,o=>{o&&t.lazyLoad&&e.value.requestLoad()}),U(()=>{!e.value||!i.value||(e.value.canvas.width=i.value.offsetWidth,e.value.canvas.height=i.value.offsetHeight,e.value.canvas.width=i.value.offsetWidth*window.devicePixelRatio,e.value.canvas.height=i.value.offsetHeight*window.devicePixelRatio,e.value.canvas.style.width=`${i.value.offsetWidth}px`,e.value.canvas.style.height=`${i.value.offsetHeight}px`,e.value.ctx.scale(window.devicePixelRatio,window.devicePixelRatio),e.value.onUpdate(!0))}),$(()=>{e.value&&e.value.onUpdate()})}),C(()=>{var a;(a=e.value)==null||a.destroy()}),I(()=>{t.lazyLoad&&V.create({trigger:i.value,start:"top bottom",end:"bottom top",onEnter:()=>{n.value=!0},onEnterBack:()=>{n.value=!0}})}),(a,o)=>(D(),N("div",{ref_key:"el",ref:i,class:"video-sequence"},null,512))}}),ie=G(ee,[["__scopeId","data-v-3ce802c4"]]),ne=(t,i,e=!1,n=0)=>{let a=n;return Array.from({length:i},()=>{let o=`${a}`;return e&&(o=o.padStart(e,"0")),a++,t.replace("{index}",o)})};export{ie as _,ne as g};
